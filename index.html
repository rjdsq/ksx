<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="shortcut icon" href="https://gh.llkk.cc/https://raw.githubusercontent.com/rjdsq/rjdsq.github.io/main/img/favicon.ico" type="image/x-icon">
<title>阚双雪 - 温故流年 - 自我感动</title>
<meta name="description" content="阚双雪/樱花特效的伤感怀旧音乐播放相册回忆录网页。">
<style>
:root {
    --bg-deep: #050505;
    --text-primary: #e6e1d8;
    --text-secondary: #858585;
    --accent-gold: #d4af37;
    --col-mobile-default: 2;
    --col-mobile-toggle: 3;
    --col-pc-default: 6;
    --col-pc-toggle: 8;
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
    margin: 0; width: 100vw; min-height: 100vh;
    background-color: black; color: var(--text-primary);
    font-family: 'Playfair Display', 'Noto Serif SC', serif;
    padding-bottom: 120px; overflow-x: hidden;
}
.noise {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    pointer-events: none; z-index: 500; opacity: 0.03;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
}
::-webkit-scrollbar { width: 0; }

.header {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 35px 20px 25px; opacity: 0; animation: fadeUp 1.2s ease forwards;
    position: relative;
}
.title {
    font-family: 'Cinzel', serif; font-size: 10px; letter-spacing: 0.3em;
    color: var(--accent-gold); opacity: 0.8; margin-bottom: 6px;
    text-transform: uppercase; position: relative; overflow: visible;
}
.title::before {
    content: ''; position: absolute; top: -14px; left: -12px;
    width: 20px; height: 20px;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3Cpath fill='%23D42E2E' d='M419.1 183.9c-12.8-63.5-56.9-88-60.6-90-50.6-28.1-133.5-25.1-140.7-24.8-5.3 0-10.4 1.3-15.1 3.7C191.9 78.4 126.9 119.3 84 195.9c-12.3 22-30.8 63-23.7 101.4 3.6 19.3 12 36.6 25 50.9l-5.6 4.2c-5.8 4.3-7 12.5-2.7 18.3l15 20c4.3 5.8 12.5 7 18.3 2.7l16-12c8.2 4.1 17.5 6.4 27.2 6.4h229.4c34.8 0 63.2-27.4 64.9-61.9.1-1.2.1-2.4.1-3.6 0-51.1-15.6-99.7-28.8-138.4z'/%3E%3Cpath fill='%23FFF' d='M396.6 348H122c-15.9 0-30-5.8-40.9-15.3-2.7-2.3-4.3-5.7-4.3-9.5 0-3.3 1.2-6.3 3.3-8.6 10.5-11.8 28.5-47.5 40.8-70.1 24.3 24.8 54.9 31.9 83.1 31.9 28 0 53.2-11.4 70.8-31.5 20.3 25.1 52.6 31.5 83.3 31.5 27.6 0 57.5-6.9 81.6-30.7 2.1 6.5 4.1 13 6 19.5 2.5 8.7 5 17.3 7 25.9 1.7 6.8 2.5 13.9 2.5 20.9 0 20.2-16.7 36-37.1 36h-21.5z'/%3E%3Ccircle cx='445.5' cy='78.5' r='45.5' fill='%23FFF'/%3E%3C/svg%3E");
    background-repeat: no-repeat; background-size: contain;
    transform: rotate(-25deg); pointer-events: none; z-index: 10;
    filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.5));
}
.subtitle {
    font-size: 20px; font-weight: 400; letter-spacing: 0.1em;
    color: rgba(255, 255, 255, 0.95); position: relative;
}
.subtitle::after {
    content: ''; display: block; width: 20px; height: 1px;
    background: var(--accent-gold); margin: 10px auto 0; opacity: 0.4;
}

#c {
    display: grid;
    grid-template-columns: repeat(var(--col-mobile-default), 1fr);
    grid-auto-flow: row dense; 
    gap: 8px; padding: 0 10px 100px;
    max-width: 1920px; margin: 0 auto;
    transition: all 0.6s cubic-bezier(0.25, 1, 0.5, 1);
}
#c.dense { grid-template-columns: repeat(var(--col-mobile-toggle), 1fr); }

@media (min-width: 768px) {
    .header { padding: 50px 20px 40px; }
    .subtitle { font-size: 24px; }
    #c { 
        grid-template-columns: repeat(var(--col-pc-default), 1fr); 
        gap: 16px; padding: 0 40px 120px;
    }
    #c.dense { grid-template-columns: repeat(var(--col-pc-toggle), 1fr); }
}

.img-wrap {
    aspect-ratio: 3/4; position: relative; border-radius: 3px;
    overflow: hidden; opacity: 0; transform: translateY(20px);
    transition: opacity 0.8s ease, transform 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
    background: #111;
}
.img-wrap.hero { grid-row: span 4; aspect-ratio: auto; height: 100%; }
.img-wrap.s { opacity: 1; transform: translateY(0); }
img {
    width: 100%; height: 100%; object-fit: cover; display: block;
    cursor: pointer; transition: transform 1.2s cubic-bezier(0.19, 1, 0.22, 1), filter 0.6s ease;
    filter: brightness(0.9) contrast(0.95) saturate(0.9);
}
.img-wrap.hero img { filter: brightness(0.95) contrast(1.0) saturate(0.95); }
.img-wrap:hover img {
    transform: scale(1.04); filter: brightness(1.05) contrast(1.05) saturate(1.05);
}

#v {
    position: fixed; inset: 0; background: rgba(0, 0, 0, 0.5);
    display: none; align-items: center; justify-content: center;
    z-index: 2000; cursor: zoom-out; backdrop-filter: blur(20px);
}
#v img {
    width: auto; height: auto; max-width: 98vw; max-height: 70vh;
    object-fit: contain; border-radius: 3px;
    box-shadow: 0 20px 80px rgba(0,0,0,0.8);
    animation: zoomIn 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
}

#lv {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: #000; z-index: 2100; display: none;
    overflow-y: auto; -webkit-overflow-scrolling: touch;
    animation: fadeIn 0.3s ease;
}
#lv img {
    display: block; width: 100%; height: auto;
    margin: 0; padding: 0;
}

@keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
@keyframes fadeUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.nav-container {
    position: fixed; bottom: 0; left: 0; width: 100%; height: 100px;
    display: flex; justify-content: center; align-items: flex-end;
    z-index: 1000; background: linear-gradient(to top, rgba(5,5,5,1) 10%, transparent);
    pointer-events: none; padding-bottom: 15px;
}
.nav {
    pointer-events: auto; width: 100%; max-width: 380px; height: 50px;
    background: rgba(20, 20, 20, 0.6);
    backdrop-filter: blur(20px) saturate(180%); -webkit-backdrop-filter: blur(20px) saturate(180%);
    border: 1px solid rgba(255,255,255,0.08); border-radius: 25px;
    display: flex; align-items: center; justify-content: space-evenly;
    box-shadow: 0 10px 40px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.05);
    position: relative; overflow: hidden;
    transition: transform 0.3s ease, background 0.3s;
}
.nav:hover { background: rgba(30, 30, 35, 0.8); transform: translateY(-2px); }
#cvs {
    position: absolute; bottom: 0; left: 0; width: 100%; height: 100%;
    opacity: 0.6; pointer-events: none; mix-blend-mode: screen;
}
.btn {
    background: none; border: none; color: #ccc;
    padding: 0; width: 34px; height: 34px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; opacity: 0.7; transition: all 0.3s ease; z-index: 2;
}
.btn:hover { opacity: 1; color: #fff; transform: scale(1.1); text-shadow: 0 0 10px rgba(255,255,255,0.5); }
.btn svg { width: 16px; height: 16px; }
.btn-l svg { width: 18px; height: 18px; }
#p {
    width: 38px; height: 38px; border-radius: 50%;
    background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
    opacity: 1; color: #fff;
}


#ml {
    position: fixed; bottom: 95px; left: 50%;
    transform: translateX(-50%) translateY(20px);
    width: 280px; max-height: 45vh;
    background: rgba(10, 10, 12, 0.85);
    backdrop-filter: blur(30px); -webkit-backdrop-filter: blur(30px);
    border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 12px;
    display: none; flex-direction: column; padding: 5px;
    overflow-y: auto; z-index: 900; opacity: 0;
    transition: opacity 0.3s, transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
    box-shadow: 0 15px 40px rgba(0,0,0,0.6), inset 0 0 20px rgba(255,255,255,0.02);
}
#ml.show { opacity: 1; transform: translateX(-50%) translateY(0); }
.mi {
    padding: 12px 16px; font-size: 13px; color: var(--text-secondary);
    cursor: pointer; transition: all 0.25s; font-weight: 300;
    border-radius: 6px; margin-bottom: 2px; display: flex; align-items: center;
}
.mi:hover { background: rgba(255,255,255,0.04); color: #fff; padding-left: 20px; }
.mi.act { 
    background: linear-gradient(90deg, rgba(212, 175, 55, 0.1), transparent);
    color: #fff; font-weight: 500; text-shadow: 0 0 10px rgba(212, 175, 55, 0.4);
}
.mi.act::before {
    content: ''; display: block; width: 4px; height: 4px;
    background: var(--accent-gold); border-radius: 50%;
    margin-right: 10px; box-shadow: 0 0 8px var(--accent-gold);
}
</style>
</head>
<body>
<div class="noise"></div>
<div class="header">
    <div class="title">KSX ZH</div>
    <div class="subtitle">温故流年</div>
</div>

<div id="c"></div>
<div id="v"><img></div>
<div id="lv"><img id="li"></div>
<div id="ml"></div>

<div class="nav-container">
    <div class="nav">
        <canvas id="cvs"></canvas>
        <button id="list" class="btn" aria-label="Menu">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"><line x1="4" y1="12" x2="20" y2="12"></line><line x1="4" y1="6" x2="20" y2="6"></line><line x1="4" y1="18" x2="20" y2="18"></line></svg>
        </button>
        <button id="b" class="btn btn-l" aria-label="Prev">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M19 20L9 12l10-8v16z"></path><path d="M5 19V5"></path></svg>
        </button>
        <button id="p" class="btn" aria-label="Play">
            <svg id="pi" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M5 3l14 9-14 9V3z"></path></svg>
        </button>
        <button id="n" class="btn btn-l" aria-label="Next">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 4l10 8-10 8V4z"></path><path d="M19 5v14"></path></svg>
        </button>
        <button id="l" class="btn" aria-label="View">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>
        </button>
    </div>
</div>

<audio id="a" hidden preload="auto" playsinline x-webkit-airplay="allow"></audio>

<script>
!function(){
    const musicFiles = ['1落日.mp3', '2在你的身边.mp3', '3星辰大海.mp3', '4温柔的徘徊.mp3', '5两个我们.mp3'];
    const rawImageFiles = ['迟来的深情.jpg','84.jpg','83.jpg','82.jpg','81.jpg','80.jpg','79.jpg','78.jpg','77.jpg','76.jpg','75.jpg','74.jpg','73.jpg','72.jpg','71.jpg','70.jpg','69.jpg','68.jpg','67.jpg','66.jpg','65.jpg','64.jpg','63.jpg','62.jpg','61.jpg','60.jpg','59.jpg','58.jpg','57.jpg','56.jpg','55.jpg','54.jpg','53.jpg','52.jpg','51.jpg','50.jpg','49.jpg','48.jpg','47.jpg','46.jpg','45.jpg','44.jpg','43.jpg','42.jpg','41.jpg','40.jpg','39.jpg','38.jpg','37.jpg','36.jpg','35.jpg','34.jpg','33.jpg','32.jpg','31.jpg','30.jpg','29.jpg','28.jpg','27.jpg','26.jpg','25.jpg','24.jpg','23.jpg','22.jpg','21.jpg','20.jpg','19.jpg','18.jpg','17.jpg','16.jpg','15.jpg','14.jpg','13.jpg','12.jpg','11.jpg','10.jpg','9.jpg','8.jpg','7.jpg','6.jpg','5.jpg','4.jpg','3.jpg','2.jpg','1.jpg'];

    const imageFiles = rawImageFiles.sort((a, b) => {
        if (a.includes('迟来的深情')) return -1;
        if (b.includes('迟来的深情')) return 1;
        const numA = parseInt(a.replace(/\D/g, '')) || 0;
        const numB = parseInt(b.replace(/\D/g, '')) || 0;
        return numB - numA; 
    });

    const musicSorter = (a, b) => b.localeCompare(b, 'zh-CN', { numeric: true });
    if(musicFiles.length) musicFiles.sort(musicSorter);

    let t=[],c=0,ia=!1,mp=!1;
    const b=document.getElementById('b'),
          q=document.getElementById('p'),
          n=document.getElementById('n'),
          u=document.getElementById('a'),
          lb=document.getElementById('l'),
          ct=document.getElementById('c'),
          ls=document.getElementById('list'),
          ml=document.getElementById('ml'),
          cvs=document.getElementById('cvs'),
          v=document.getElementById('v'),
          lv=document.getElementById('lv'),
          li=document.getElementById('li'),
          pi=document.getElementById('pi');

    let ac, an, src, ctx, gr;
    let inited = false;

    function initAudio() {
        if(inited) return;
        try {
            const AC = window.AudioContext || window.webkitAudioContext;
            if(!AC) return;
            ac = new AC();
            an = ac.createAnalyser();
            an.fftSize = 256;
            an.smoothingTimeConstant = 0.85;
            src = ac.createMediaElementSource(u);
            src.connect(an);
            an.connect(ac.destination);
            ctx = cvs.getContext('2d', { alpha: true });
            resize();
            window.addEventListener('resize', resize);
            inited = true;
            if('mediaSession' in navigator){
                navigator.mediaSession.setActionHandler('play', () => u.play());
                navigator.mediaSession.setActionHandler('pause', () => u.pause());
                navigator.mediaSession.setActionHandler('previoustrack', () => ld(c-1));
                navigator.mediaSession.setActionHandler('nexttrack', () => ld(c+1));
            }
            render();
        } catch(e) { console.log(e); }
    }

    function resize() {
        const dpr = Math.min(window.devicePixelRatio || 1, 2);
        cvs.width = cvs.offsetWidth * dpr;
        cvs.height = cvs.offsetHeight * dpr;
        if(ctx) {
            ctx.scale(dpr, dpr);
            gr = ctx.createLinearGradient(0, cvs.offsetHeight, 0, 0);
            gr.addColorStop(0, 'rgba(255, 255, 255, 0.4)');
            gr.addColorStop(0.4, 'rgba(212, 175, 55, 0.3)');
            gr.addColorStop(1, 'rgba(212, 175, 55, 0)');
            
            ctx.shadowBlur = 4;
            ctx.shadowColor = 'rgba(212, 175, 55, 0.4)';
        }
    }

    function render() {
        if(!inited) return;
        requestAnimationFrame(render);
        const w = cvs.offsetWidth;
        const h = cvs.offsetHeight;
        ctx.clearRect(0, 0, w, h);
        if(u.paused) return;
        
        const len = an.frequencyBinCount;
        const da = new Uint8Array(len);
        an.getByteFrequencyData(da);
        
        const bars = 48;
        const step = Math.floor(len * 0.8 / bars);
        const gap = w / bars;
        const bw = gap * 0.4;
        
        ctx.fillStyle = gr;
        ctx.beginPath();
        
        for(let i = 0; i < bars; i++) {
            let sum = 0;
            for(let j = 0; j < step; j++) {
                sum += da[i * step + j];
            }
            const avg = sum / step;
            const val = (Math.pow(avg / 255, 1.5)) * h * 0.4;
            
            const x = i * gap + gap/2 + 12;
            const y = h - val;
            
            ctx.roundRect(x - bw/2, y, bw, val + 2, 4);
        }
        ctx.fill();
    }

    function setIcon(p) {
        pi.innerHTML = p 
            ? '<rect x="7" y="6" width="3" height="12" rx="1.5"/><rect x="14" y="6" width="3" height="12" rx="1.5"/>' 
            : '<path d="M5 3l14 9-14 9V3z"/>';
    }

    lb.onclick=()=>{ct.classList.toggle('dense')};
    
    ls.onclick=(e)=>{
        e.stopPropagation();
        if(ml.style.display === 'flex') {
            ml.classList.remove('show');
            setTimeout(()=>ml.style.display='none', 300);
        } else {
            ml.style.display = 'flex';
            requestAnimationFrame(()=>ml.classList.add('show'));
            const act = ml.querySelector('.act');
            if(act) act.scrollIntoView({block:"center"});
        }
    };

    window.addEventListener('click', (e) => {
        if(ml.style.display === 'flex' && !e.target.closest('#list') && !e.target.closest('#ml')) {
            ml.classList.remove('show');
            setTimeout(()=>ml.style.display='none', 300);
        }
    });

    const upd=()=>{
        Array.from(ml.children).forEach((el,i)=>{
            el.className = i===c ? 'mi act' : 'mi';
        });
        if(t[c] && 'mediaSession' in navigator){
            navigator.mediaSession.metadata = new MediaMetadata({
                title: t[c].n, artist: 'KSX ZH',
                artwork: [{ src: 'https://gh.llkk.cc/https://raw.githubusercontent.com/rjdsq/rjdsq.github.io/main/img/favicon.ico', sizes: '192x192', type: 'image/png' }]
            });
            navigator.mediaSession.playbackState = "playing";
        }
    };

    u.onplay = () => {
        setIcon(true);
        ia = true;
        if(!inited) initAudio();
        if(ac && ac.state === 'suspended') ac.resume();
        upd();
    };

    u.onpause = () => { setIcon(false); };

    const pp=()=>{
        if(!t.length)return;
        if(!inited) initAudio();
        if(u.paused){ mp=!1; u.play(); } else { mp=!0; u.pause(); }
    };
    
    const ld = async (i) => {
        if(!t.length) return;
        c = (i + t.length) % t.length;
        upd();
        u.autoplay = true;
        u.src = t[c].u;
        mp = false;
        try {
            await u.play();
        } catch(e) { console.error(e); }
    };

    u.onended = () => { ld(c+1); };

    if(musicFiles.length) {
        t = musicFiles.map(f => ({
            u: `./mp3/${f}`,
            n: f.replace(/\.mp3$/i, '').replace(/[^\u4e00-\u9fa5]/g,'') || f.replace(/\.mp3$/i, '')
        }));
        
        t.forEach((s,i)=>{
            let d=document.createElement('div');
            d.className='mi';
            d.textContent=s.n;
            d.onclick=()=>{ld(i);ml.classList.remove('show');setTimeout(()=>ml.style.display='none',300)};
            ml.appendChild(d);
        });
        u.src = t[0].u; 
        if('mediaSession' in navigator){
            navigator.mediaSession.metadata = new MediaMetadata({
                title: t[0].n, artist: 'KSX ZH',
                artwork: [{ src: 'https://gh.llkk.cc/https://raw.githubusercontent.com/rjdsq/rjdsq.github.io/main/img/favicon.ico', sizes: '192x192', type: 'image/png' }]
            });
        }
    }

    window.addEventListener('popstate', () => {
        v.style.display = 'none';
        lv.style.display = 'none';
    });

    const closeViewer = () => {
        if(v.style.display !== 'none' || lv.style.display !== 'none') {
            history.back();
        }
    };

    if(imageFiles.length) {
        imageFiles.forEach((f, i) => {
            const w = document.createElement('div');
            w.className = 'img-wrap';
            if(f.includes('迟来的深情')) w.classList.add('hero');
            
            w.style.transitionDelay = `${Math.min(i * 0.03, 1)}s`;
            
            const img = document.createElement('img');
            img.decoding = 'async';
            img.loading = 'lazy';
            img.src = `./img/${f}`;
            
            img.onload = () => w.classList.add('s');
            
            w.onclick = () => {
                if(u.paused && !mp) u.play().catch(()=>{});
                
                history.pushState({modal: true}, null, '');

                if(f.includes('迟来的深情')) {
                    li.src = img.src;
                    lv.style.display = 'block';
                    lv.scrollTop = 0;
                } else {
                    const i2 = v.querySelector('img');
                    if(i2.src !== img.src) i2.src = img.src;
                    v.style.display = 'flex';
                }
            };
            w.appendChild(img);
            ct.appendChild(w);
        });
        v.onclick = closeViewer;
        lv.onclick = closeViewer;
    }

    q.onclick=pp;
    b.onclick=()=>{ld(c-1)};
    n.onclick=()=>{ld(c+1)};
    
    document.addEventListener('click',(e)=>{
        if(!inited && t.length) initAudio();
        if(ac && ac.state === 'suspended') ac.resume();
    });
}();
</script>
</body>
</html>